from lammps_hic.lammps import *
import numpy as np
import filecmp

def test_dummy_atom():
    d = DummyAtoms(4)
    r = [d.next() for i in range(11)]
    assert (r == [4 for i in range(10)] + [5])


def test_small_diploid():
    np.array( [[  701.84367135,   944.00866375,   849.02423973],
               [ 2106.27654106,   545.6146285 ,  1940.38434638],
               [  477.35779086,  2603.02505345,   317.51722608],
               [ 2091.40749696,  1134.37654649,  1117.48404861],
               [  726.98807866,  2256.28725138,  1042.39582041],
               [ 1560.58171614,  1853.1316856 ,    61.71708542],
               [ 2647.84608774,  1126.00805005,  2311.05831877],
               [  180.88234875,  1217.06425016,  1771.208459  ],
               [ 1304.83737597,   938.27913795,  1772.20789176],
               [ 2791.94325843,  1980.78117672,  2198.87444552],
               [  235.97162838,  1778.02528135,  2586.68343813],
               [  302.82983055,  2648.3903976 ,  1418.84082157],
               [ 1770.07030883,   241.45473944,   283.80680728],
               [  239.49367544,  2374.96222074,    84.66218934],
               [ 2701.56550408,  1430.449233  ,  1588.60488288],
               [ 2285.47728175,  2099.54296526,  2453.81346428],
               [ 2731.73089115,   289.5737784 ,  2731.55760025],
               [  666.38329271,   697.67332634,  1198.02761499],
               [ 2706.72246109,  2671.58015661,   989.26526344],
               [  523.02106012,  1724.80439537,  1385.30531069]])
    
    chrom = ['chr' + str(k) for k in range(2) for j in range(4)] + ['chrX', 'chrX']
    chrom += chrom[:]
    generate_input_single_radius(crd, 100, chrom, {'seed': 38611645})
    assert(filecmp.cmp('input.data', 'small-diploid-input.data'))
    assert(filecmp.cmp('minimize.lam', 'small-diploid-minimize.lam'))


def test_final_energy_estraction():
    with open('small-diploid-log.lammps') as f:
        info = get_info_from_log(f)
    assert(info['final-energy'] == 0)
